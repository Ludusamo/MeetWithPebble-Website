var Timeline = require('pebble-api');

var timeline = new Timeline();

module.exports = {
	createPin: function(group, event) {
		return new Timeline.Pin ({
			"id": group._id.oid + event._id.oid,
			"time": event.time,
			"duration": event.duration * 60,
			"layout": new Timeline.Pin.Layout({
				"type": "calendarPin",
				"title": event.eventName,
				"locationName": event.location,
				"body": event.description
			}),
			"reminders": [
				{
					"time": event.time - (24 * 60),
					"layout": {
						"type": "calendarReminder",
						"title": event.eventName,
						"locationName": event.location,
						"tinyIcon": "system://images/TIMELINE_CALENDAR"
					}
				},
				{
					"time": event.time - (12 * 60),
					"layout": {
						"type": "calendarReminder",
						"title": event.eventName,
						"locationName": event.location,
						"tinyIcon": "system://images/TIMELINE_CALENDAR"
					}
				}
			]
		})
	},
	sendPin: function(user, pin) {
		timeline.sendUserPin(user.local.timelineToken, pin, function(err) {
			if (err) console.error(err);
			else console.log("Pin successfully sent.");
		});
	}
};
